#!/usr/bin/make -f

# This file is part of the python-werkzeug package.

# Copyright (C) 2007 Noah Slater <nslater@bytesexual.org>.

# Copying and distribution of this file, with or without modification, are
# permitted in any medium without royalty provided the copyright notice and this
# notice are preserved.

# Makefile used by dpkg-buildpackage to create a deb file.

DEB_PYTHON_SYSTEM := pysupport

include /usr/share/cdbs/1/rules/buildcore.mk
include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/class/python-distutils.mk
include /usr/share/cdbs/1/rules/simple-patchsys.mk

DEB_PYTHON_INSTALL_ARGS_ALL += --single-version-externally-managed

UPSTREAM_REPOSITORY_ADDRESS = http://trac.pocoo.org/repos/werkzeug/trunk

PACKAGE_NAME_FRAGMENT = python-werkzeug
PACKAGE_VERSION_FRAGMENT = 0.1~svn

clean::
	rm --force werkzeug-bootstrap.1
	rm --force debian/copyright.html
	rm --force docs/build/*.html
	rm --recursive --force docs/html
	rm --recursive --force docs/txt

common-build-indep::
	help2man --no-info --name="generate Werkzeug bootstrapping code" \
	    ./werkzeug-bootstrap > werkzeug-bootstrap.1
	cd docs && ./generate.py
	cp --preserve --recursive docs/build docs/html
	cp --preserve --recursive docs/src docs/txt
	find docs/txt -type f | xargs gzip -9
	chmod a+x examples/upload.py

get-orig-source:
	@if [ "$$REVISION" = "" ]; then \
	    REVISION=$(shell LC_ALL=C svn --non-interactive info \
			$(UPSTREAM_REPOSITORY_ADDRESS) | grep Revision | cut -c 11-); \
	fi; \
	if [ "$$REVISION" = "" ]; then \
		exit 1; \
	fi; \
	LC_ALL=C svn --quiet export --revision $${REVISION} \
		$(UPSTREAM_REPOSITORY_ADDRESS) \
		$(PACKAGE_NAME_FRAGMENT)-$(PACKAGE_VERSION_FRAGMENT)$${REVISION}.orig; \
	tar --create --gzip --file \
		$(PACKAGE_NAME_FRAGMENT)_$(PACKAGE_VERSION_FRAGMENT)$${REVISION}.orig.tar.gz \
		$(PACKAGE_NAME_FRAGMENT)-$(PACKAGE_VERSION_FRAGMENT)$${REVISION}.orig; \
	rm --recursive --force \
		$(PACKAGE_NAME_FRAGMENT)-$(PACKAGE_VERSION_FRAGMENT)$${REVISION}.orig;
