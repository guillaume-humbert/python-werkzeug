#!/usr/bin/make -f

# Copyright 2009, Noah Slater <nslater@tumbolia.org>

# Copying and distribution of this file, with or without modification, are
# permitted in any medium without royalty provided the copyright notice and this
# notice are preserved.

#export DH_VERBOSE=1
export PYTHONPATH=$(abspath $(CURDIR))
PKGDIR=$(CURDIR)/debian/python-werkzeug/

-include /usr/share/python/python.mk
ifeq (,$(py_libdir))
    py_libdir = /usr/lib/python$(subst python,,$(1))/site-packages
endif

%:
	dh $@

override_dh_auto_install:
	python setup.py install \
		--single-version-externally-managed \
		--install-layout=deb \
		--root $(PKGDIR)
	touch $(PKGDIR)$(call py_libdir,$(shell pyversions -vd))/werkzeug/debug/shared/.noinit
	touch $(PKGDIR)$(call py_libdir,$(shell pyversions -vd))/werkzeug/debug/templates/.noinit
	dh_link usr/share/javascript/jquery/jquery.js \
	  $(call py_libdir,$(shell pyversions -vd))/werkzeug/debug/shared/jquery.js
	dh_link usr/share/javascript/jquery/jquery.js \
	  /usr/share/doc/python-werkzeug/html/_static/jquery.js
	dh_link /usr/share/doc/python-werkzeug/html/_sources \
		/usr/share/doc/python-werkzeug/rst

clean:
	dh $@
	make -C docs clean
	find $(CURDIR) -name '*\.py[co]' -delete
	rm -rf build
